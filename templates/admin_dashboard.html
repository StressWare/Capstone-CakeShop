<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin ‚Äì Ms. Brave Cake Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Google Charts -->
   <link href="../static/admin_dashboard.css" rel="stylesheet">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load("current", {packages:["corechart"]});
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
      // Weekly Sales
      var salesData = google.visualization.arrayToDataTable([
        ['Day', 'Sales'],
        {% for day, val in weekly_sales.items() %}
        ['{{ day }}', {{ val|float }}],
        {% endfor %}
      ]);
      var salesChart = new google.visualization.PieChart(document.getElementById('weeklySalesChart'));
      salesChart.draw(salesData, {
        title: 'Weekly Sales',
        is3D: true,
        width: 250,
        height: 250
      });

      // Weekly Expenses
      var expensesData = google.visualization.arrayToDataTable([
        ['Day', 'Expenses'],
        {% for day, val in weekly_expenses.items() %}
        ['{{ day }}', {{ val|float }}],
        {% endfor %}
      ]);
      var expensesChart = new google.visualization.PieChart(document.getElementById('weeklyExpensesChart'));
      expensesChart.draw(expensesData, {
        title: 'Weekly Expenses',
        is3D: true,
        width: 250,
        height: 250
      });

      // Weekly Profit
      var profitData = google.visualization.arrayToDataTable([
        ['Day', 'Profit'],
        {% for day, val in weekly_profit.items() %}
        ['{{ day }}', {{ val|float }}],
        {% endfor %}
      ]);
      var profitChart = new google.visualization.ColumnChart(
        document.getElementById('weeklyProfitChart')
      );
      profitChart.draw(profitData, {
        title: 'Weekly Profit',
        width: 250,
        height: 250,
        legend: { position: 'none' },
        colors: ['#28a745']
      });
    }
  </script>

</head>
<body class="bg-light">
  <!-- ============ SIDEBAR ============ -->
<div class="sidebar">
  <div class="sidebar-brand">
    <i class="fas fa-cake-candles me-2"></i>Ms. Brave Admin
  </div>

  <ul class="sidebar-menu">
    <li><a href="#dashboard" class="active"><i class="fas fa-home me-2"></i>Dashboard</a></li>
    <li><a href="#status-overview"><i class="fas fa-tachometer-alt me-2"></i>Status Overview</a></li>
    <li><a href="#analytics"><i class="fas fa-chart-line me-2"></i>Analytics</a></li>
    <li><a href="#sales"><i class="fas fa-money-bill-wave me-2"></i>Sales</a></li>
    <li><a href="#expenses"><i class="fas fa-receipt me-2"></i>Expenses</a></li>
    <li><a href="#inventory"><i class="fas fa-boxes me-2"></i>Inventory</a></li>
    <li><a href="#orders"><i class="fas fa-list-check me-2"></i>Order List</a></li>
    <li><a href="#cake-availability"><i class="fas fa-cake-candles me-2"></i>Cake Availability</a></li>
  </ul>

  <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #34495e;">
    <a href="/logout" style="color: #e74c3c; text-decoration: none; padding: 12px 15px; display: block; border-radius: 5px; transition: all 0.3s;">
      <i class="fas fa-sign-out-alt me-2"></i>Logout
    </a>
  </div>
</div>
<div class="main-content">
<div class="container-fluid my-4 px-4" id="dashboard">
  <!-- DASHBOARD HEADER -->
  <div class="section-header">
    <h1 class="mb-2">
      <i class="fas fa-chart-pie me-3"></i>Admin Dashboard
    </h1>
    <p class="mb-0 opacity-75">Complete overview of your cake shop business</p>
  </div>
  
  <!-- ============ 1. STATUS OVERVIEW (Stat Cards + Low Stock + Today's Deliveries) ============ -->
  <section id="status-overview" class="mb-5">
    <h3 class="mb-3">
      <i class="fas fa-tachometer-alt me-2 text-primary"></i>Status Overview
    </h3>
    <div class="row g-3">
      <!-- LEFT COLUMN: 8 Stat Cards + Low Stock -->
      <div class="col-md-7">
        <div class="row g-2">
          <!-- NEW Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">üÜï</div>
              <h6 class="text-muted mb-0 small">NEW</h6>
              <h2 class="mb-0 fw-bold text-secondary">{{ total_new }}</h2>
            </div>
          </div>
          <!-- ACCEPTED Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">‚úÖ</div>
              <h6 class="text-muted mb-0 small">ACCEPTED</h6>
              <h2 class="mb-0 fw-bold text-info">{{ total_accepted }}</h2>
            </div>
          </div>
          <!-- PENDING Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">‚è≥</div>
              <h6 class="text-muted mb-0 small">PENDING</h6>
              <h2 class="mb-0 fw-bold text-warning">{{ total_pending }}</h2>
            </div>
          </div>
          <!-- READY Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">üéÇ</div>
              <h6 class="text-muted mb-0 small">READY</h6>
              <h2 class="mb-0 fw-bold text-primary">{{ total_ready }}</h2>
            </div>
          </div>
          <!-- OUT FOR DELIVERY Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">üì¶</div>
              <h6 class="text-muted mb-0 small">OUT</h6>
              <h2 class="mb-0 fw-bold">{{ total_out }}</h2>
            </div>
          </div>
          <!-- COMPLETED Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">üü¢</div>
              <h6 class="text-muted mb-0 small">COMPLETED</h6>
              <h2 class="mb-0 fw-bold text-success">{{ total_completed }}</h2>
            </div>
          </div>
          <!-- CANCELLED Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">‚ùå</div>
              <h6 class="text-muted mb-0 small">CANCEL</h6>
              <h2 class="mb-0 fw-bold text-danger">{{ total_cancelled }}</h2>
            </div>
          </div>
          <!-- RUSH Card -->
          <div class="col-6 col-md-3">
            <div class="card stat-card text-center p-2">
              <div class="fs-2 mb-1">‚ö†Ô∏è</div>
              <h6 class="text-muted mb-0 small">RUSH</h6>
              <h2 class="mb-0 fw-bold text-danger">{{ total_rush }}</h2>
            </div>
          </div>
          
          <!-- LOW STOCK ALERT (Below stat cards) -->
          <div class="col-12 mt-3">
            <div class="card">
              <div class="card-body py-2">
                <div class="d-flex align-items-center">
                  <h5 class="mb-0 me-3">‚ö†Ô∏è <strong>LOW STOCK:</strong></h5>
                  {% if low_stock %}
                    <div class="d-flex flex-wrap gap-2">
                      {% for i in low_stock %}
                        <span class="badge {% if i.quantity < 5 %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2">
                          {{ i.item }}: {{ i.quantity }} left
                        </span>
                      {% endfor %}
                    </div>
                  {% else %}
                    <span class="text-muted">All items stocked</span>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN: Today's Deliveries -->
      <div class="col-md-5">
        <div class="card h-100">
          <div class="card-header bg-white">
            <h5 class="mb-0">üöö Today's Deliveries</h5>
          </div>
          <div class="card-body p-2" style="max-height: 400px; overflow-y: auto;">
            {% if today_deliveries %}
              {% for delivery in today_deliveries %}
              <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                <div>
                  <span class="badge bg-light text-dark me-2">üïë {{ delivery.time }}</span>
                  {% if delivery.rush %}
                    <span class="badge bg-danger">RUSH</span>
                  {% endif %}
                  <strong class="d-block">{{ delivery.customer }}</strong>
                  <small class="text-muted">{{ delivery.cake[:30] }}{% if delivery.cake|length > 30 %}...{% endif %}</small>
                </div>
                <span class="badge 
                  {% if delivery.status == 'New' %}bg-secondary
                  {% elif delivery.status == 'Accepted' %}bg-info
                  {% elif delivery.status == 'Pending' %}bg-warning text-dark
                  {% elif delivery.status == 'Ready' %}bg-primary
                  {% elif delivery.status == 'Out for Delivery' %}bg-dark
                  {% endif %}">
                  {{ delivery.status }}
                </span>
              </div>
              {% endfor %}
            {% else %}
              <div class="text-center py-3 text-muted">
                No deliveries today
              </div>
            {% endif %}
          </div>
          <div class="card-footer bg-white text-end">
            <small class="text-muted">Total: {{ today_count }} deliveries today</small>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- DIVIDER -->
  <div class="section-divider">
    <span class="section-divider-text">üìà BUSINESS ANALYTICS</span>
  </div>
  
  <!-- ============ 2. ANALYTICS (Charts) ============ -->
  <section id="analytics" class="mb-5">
    <h3 class="mb-3">
      <i class="fas fa-chart-line me-2 text-success"></i>Analytics Overview
    </h3>
    <div class="row">
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">üíµ Weekly Sales</h5>
            <div id="weeklySalesChart" style="width:100%; height:250px;"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">üí∞ Weekly Expenses</h5>
            <div id="weeklyExpensesChart" style="width:100%; height:250px;"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">üìä Weekly Profit</h5>
            <div id="weeklyProfitChart" style="width:100%; height:250px;"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- DIVIDER -->
  <div class="section-divider">
    <span class="section-divider-text">üìã DETAILED RECORDS</span>
  </div>
  
  <!-- ============ 4. SALES TABLE ============ -->
  <section id="sales" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-money-bill-wave me-2"></i>Sales Records
        </h4>
      </div>
      <div class="card-body">
        <!-- SEARCH & FILTERS FOR SALES -->
        <div class="row mb-3">
          <div class="col-md-9 mb-2">
            <div class="input-group">
              <span class="input-group-text bg-white">
                <i class="fas fa-search"></i>
              </span>
              <input type="text" class="form-control" placeholder="Search by order name..." id="searchSales">
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <select class="form-select" id="orderFilterSales">
              <option value="">All Orders</option>
              <option value="Chocolate">Chocolate Cake</option>
              <option value="Vanilla">Vanilla Cake</option>
              <option value="Ube">Ube Cake</option>
              <!-- Add more cake types from your sales -->
            </select>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle" id="salesTable">
            <thead class="table-dark">
              <tr>
                <th>Date</th>
                <th>Order</th>
                <th>Amount (‚Ç±)</th>
              </tr>
            </thead>
            <tbody>
              {% for s in sales %}
              <tr>
                <td>
                  <small>{{ s.created_at.strftime('%b %d, %Y') }}</small><br>
                  <small class="text-muted">{{ s.created_at.strftime('%I:%M %p') }}</small>
                </td>
                <td>{{ s.item }}</td>
                <td class="fw-bold text-success">‚Ç±{{ "%.2f"|format(s.amount) }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">
                  <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                  No sales yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- PAGINATION FOR SALES -->
        <nav aria-label="Sales pagination" class="mt-3">
          <ul class="pagination justify-content-end mb-0" id="salesPagination">
            <!-- Pagination buttons generated by JavaScript -->
          </ul>
        </nav>
      </div>
    </div>
  </section>
  
  <!-- ============ 5. EXPENSES TABLE ============ -->
  <section id="expenses" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-receipt me-2"></i>Expenses
        </h4>
      </div>
      <div class="card-body">
        <!-- SEARCH & FILTERS FOR EXPENSES -->
        <div class="row mb-3">
          <div class="col-md-12 mb-2">
            <div class="input-group">
              <span class="input-group-text bg-white">
                <i class="fas fa-search"></i>
              </span>
              <input type="text" class="form-control" placeholder="Search by description..." id="searchExpenses">
            </div>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover mb-0" id="expensesTable">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Cost (‚Ç±)</th>
              </tr>
            </thead>
            <tbody>
              {% for e in expenses %}
              <tr>
                <td>
                  <small>{{ e.date.strftime('%b %d, %Y') }}</small><br>
                  <small class="text-muted">{{ e.date.strftime('%I:%M %p') }}</small>
                </td>
                <td><strong>{{ e.description }}</strong></td>
                <td class="fw-bold text-danger">‚Ç±{{ "%.2f"|format(e.cost) }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">
                  <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                  No expenses yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- PAGINATION FOR EXPENSES -->
        <nav aria-label="Expenses pagination" class="mt-3">
          <ul class="pagination justify-content-end mb-0" id="expensesPagination">
            <!-- Pagination buttons generated by JavaScript -->
          </ul>
        </nav>
      </div>
    </div>
  </section>
  
  <!-- ============ 6. INVENTORY TABLE ============ -->
<section id="inventory" class="mb-5">
  <div class="card shadow-sm">
    <div class="card-header card-header-custom">
      <h4 class="mb-0">
        <i class="fas fa-boxes me-2"></i>Inventory Management
      </h4>
    </div>
    <div class="card-body">
      <form method="POST" action="/inventory/add" class="row g-3 mb-4">
        <div class="col-md-4">
          <label class="form-label">Item Name</label>
          <input name="item" class="form-control" placeholder="e.g., Flour, Sugar" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Quantity</label>
          <input name="quantity" type="number" class="form-control" placeholder="0" min="1" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Cost (‚Ç±)</label>
          <input name="cost" type="number" class="form-control" placeholder="0.00" step="0.01" min="0" required>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">
            <i class="fas fa-plus me-2"></i>Add Item
          </button>
        </div>
      </form>

      <!-- SEARCH & FILTERS FOR INVENTORY -->
      <div class="row mb-3">
        <div class="col-md-9 mb-2">
          <div class="input-group">
            <span class="input-group-text bg-white">
              <i class="fas fa-search"></i>
            </span>
            <input type="text" class="form-control" placeholder="Search by item name..." id="searchInventory">
          </div>
        </div>
        <div class="col-md-3 mb-2">
          <select class="form-select" id="statusFilterInventory">
            <option value="">All Status</option>
            <option value="critical">Critical (< 5)</option>
            <option value="low">Low Stock (< 10)</option>
            <option value="good">Good Stock</option>
          </select>
        </div>
      </div>

      <!-- INVENTORY TABLE (WITH ORDERS TABLE DESIGN) -->
      <div class="table-responsive">
        <table class="table table-hover align-middle" id="inventoryTable">
          <thead class="table-light">
            <tr>
              <th>Item</th>
              <th>Quantity</th>
              <th>Cost (‚Ç±)</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for i in inventory %}
            <tr class="{% if i.quantity < 5 %}table-danger{% elif i.quantity < 10 %}table-warning{% endif %}">
              <td>
                <strong>{{ i.item }}</strong>
              </td>
              <td>
                <small>Qty:</small><br>
                <span class="badge 
                  {% if i.quantity < 5 %}bg-danger
                  {% elif i.quantity < 10 %}bg-warning text-dark
                  {% else %}bg-success
                  {% endif %}">
                  {{ i.quantity }}
                </span>
              </td>
              <td>
                <small>Cost:</small><br>
                <strong>‚Ç±{{ i.cost }}</strong>
              </td>
              <td>
                <small>Status:</small><br>
                {% if i.quantity < 5 %}
                  <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i> Critical</span>
                {% elif i.quantity < 10 %}
                  <span class="badge bg-warning text-dark"><i class="fas fa-exclamation"></i> Low Stock</span>
                {% else %}
                  <span class="badge bg-success"><i class="fas fa-check"></i> Good</span>
                {% endif %}
              </td>
              <td>
                <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ i.id }}">
                  <i class="fas fa-edit"></i> Edit
                </button>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted py-5">
                <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                No inventory items yet
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- PAGINATION FOR INVENTORY -->
      <nav aria-label="Inventory pagination" class="mt-3">
        <ul class="pagination justify-content-end mb-0" id="inventoryPagination"></ul>
      </nav>
    </div>
  </div>
</section>
  
  <!-- ============ 7. ORDER LIST ============ -->
  <section id="orders" class="mb-5">
    <div class="card shadow-sm bg-">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-list-check me-2"></i>Order Management
        </h4>
      </div>
      <div class="card-body">
        <!-- SEARCH & FILTERS -->
        <div class="row mb-3">
          <div class="col-md-6 mb-2">
            <div class="input-group">
              <span class="input-group-text bg-white">
                <i class="fas fa-search"></i>
              </span>
              <input type="text" class="form-control" placeholder="Search orders, customers, contact..." id="searchOrders">
            </div>
          </div>
          <div class="col-md-6">
            <div class="row g-2">
              <div class="col-md-6">
                <select class="form-select" id="statusFilter">
                  <option value="">All Status</option>
                  <option value="New">üÜï New</option>
                  <option value="Accepted">‚úÖ Accepted</option>
                  <option value="Pending">‚è≥ Pending</option>
                  <option value="Ready">üéÇ Ready</option>
                  <option value="Out for Delivery">üì¶ Out for Delivery</option>
                  <option value="Completed">üü¢ Completed</option>
                  <option value="Cancelled">‚ùå Cancelled</option>
                </select>
              </div>
              <div class="col-md-6">
                <select class="form-select" id="rushFilter">
                  <option value="">All Orders</option>
                  <option value="yes">‚ö†Ô∏è Rush Only</option>
                  <option value="no">Non-Rush</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ORDERS TABLE -->
        <div class="table-responsive">
          <table class="table table-hover align-middle" id="ordersTable">
            <thead class="table-light">
              <tr>
                <th>Date Ordered</th>
                <th>Customer</th>
                <th>Order Details</th>
                <th>Delivery Date</th>
                <th>Status</th>
                <th>Details</th>
                <th>Update Status</th>
              </tr>
            </thead>
            <tbody>
              {% for o in orders %}
              <tr class="{% if o.rush %}table-danger{% endif %}">
                <td>
                  <small>{{ o.created_at.strftime('%b %d, %Y') }}</small><br>
                  <small class="text-muted">{{ o.created_at.strftime('%I:%M %p') }}</small>
                </td>
                <td>
                  <strong>{{ o.customer.name }}</strong>
                  {% if o.rush %}
                    <span class="badge bg-danger ms-1">RUSH</span>
                  {% endif %}
                  <br>
                  <small class="text-muted">
                    <i class="fas fa-phone me-1"></i>{{ o.customer.contact }}
                  </small>
                </td>
                <td>
                  <span class="text-truncate d-inline-block" style="max-width: 200px;" title="{{ o.item }}">
                    {{ o.item }}
                  </span>
                </td>
                <td>
                  <small>{{ o.delivery_date.strftime('%b %d, %Y') }}</small><br>
                  <small class="text-muted">{{ o.delivery_date.strftime('%I:%M %p') }}</small>
                </td>
                <td>
                  <span class="badge
                    {% if o.status == 'New' %}bg-secondary
                    {% elif o.status == 'Accepted' %}bg-info
                    {% elif o.status == 'Pending' %}bg-warning text-dark
                    {% elif o.status == 'Ready' %}bg-primary
                    {% elif o.status == 'Out for Delivery' %}bg-dark
                    {% elif o.status == 'Completed' %}bg-success
                    {% elif o.status == 'Cancelled' %}bg-danger
                    {% endif %}">
                    {{ o.status }}
                  </span>
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#details{{ o.id }}">
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
                <td>
                  <form method="POST" action="/order/status/{{ o.user_id }}/{{ o.id }}" onsubmit="return confirmStatus('{{ o.status }}')">
                    <select name="status" class="form-select form-select-sm mb-1">
                      <option value="New" {{ 'selected' if o.status=='New' }}>üÜï New</option>
                      <option value="Accepted" {{ 'selected' if o.status=='Accepted' }}>‚úÖ Accepted</option>
                      <option value="Pending" {{ 'selected' if o.status=='Pending' }}>‚è≥ Pending</option>
                      <option value="Ready" {{ 'selected' if o.status=='Ready' }}>üéÇ Ready</option>
                      <option value="Out for Delivery" {{ 'selected' if o.status=='Out for Delivery' }}>üì¶ Out for Delivery</option>
                      <option value="Completed" {{ 'selected' if o.status=='Completed' }}>üü¢ Completed</option>
                      <option value="Cancelled" {{ 'selected' if o.status=='Cancelled' }}>‚ùå Cancelled</option>
                    </select>
                    <button class="btn btn-primary btn-sm w-100">
                      <i class="fas fa-sync-alt"></i> Update
                    </button>
                  </form>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="7" class="text-center text-muted py-5">
                  <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                  No orders yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- PAGINATION FOR ORDERS -->
        <nav aria-label="Orders pagination" class="mt-3">
          <ul class="pagination justify-content-end mb-0" id="ordersPagination">
            <!-- Pagination buttons generated by JavaScript -->
          </ul>
        </nav>
      </div>
    </div>
  </section>

  <!-- ============ 8. CAKE AVAILABILITY SECTION ============ -->
  <section id="cake-availability" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header bg-light text-dark d-flex justify-content-between align-items-center">
        <h4 class="mb-0">
          <i class="fas fa-cake-candles me-2"></i>Cake Availability
        </h4>
        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#cakeModal">
          <i class="fas fa-plus me-2"></i>Add New Cake
        </button>
      </div>
      <div class="card-body">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- SEARCH & FILTERS (Frontend only) -->
        <div class="row mb-4">
          <div class="col-md-6 mb-2">
            <div class="input-group">
              <span class="input-group-text bg-white">
                <i class="fas fa-search"></i>
              </span>
              <input type="text" class="form-control" id="searchCakes" placeholder="Search cakes by name...">
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <select class="form-select" id="categoryFilter">
              <option value="">All Categories</option>
              <option value="Birthday">Birthday</option>
              <option value="Wedding">Wedding</option>
              <option value="Anniversary">Anniversary</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          <div class="col-md-3 mb-2">
            <select class="form-select" id="cakeStatusFilter">
              <option value="">All Status</option>
              <option value="available">Available</option>
              <option value="unavailable">Unavailable</option>
            </select>
          </div>
        </div>

        <!-- CAKE CARDS GRID -->
        <div class="row g-3" id="cakesGrid">
          {% for cake in cakes %}
          <div class="col-lg-3 col-md-4 col-sm-6 cake-item" 
               data-name="{{ cake.name|lower }}" 
               data-category="{{ cake.category }}" 
               data-status="{{ 'available' if cake.status else 'unavailable' }}">
            <div class="card cake-card h-100">
              <div class="position-relative">
                <div class="cake-image-placeholder">
                  {% if cake.image %}
                    <img src="{{ url_for('static', filename='uploads/' + cake.image) }}" alt="{{ cake.name }}" style="width:100%; height:200px; object-fit:cover;">
                  {% else %}
                    üéÇ
                  {% endif %}
                </div>
                <span class="badge cake-status-badge {{ 'bg-success' if cake.status else 'bg-danger' }}">
                  {{ 'Available' if cake.status else 'Unavailable' }}
                </span>
              </div>
              <div class="card-body">
                <h5 class="card-title mb-2">{{ cake.name }}</h5>
                <span class="badge bg-warning text-dark mb-2">{{ cake.category }}</span>
                <p class="card-text small text-muted mb-2">{{ cake.description[:60] }}{% if cake.description|length > 60 %}...{% endif %}</p>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <span class="fw-bold text-success fs-5">‚Ç±{{ "%.2f"|format(cake.price) }}</span>
                  <span class="badge bg-secondary">{{ cake.quantity }} left</span>
                </div>
                <div class="d-grid gap-2">
                  <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editCakeModal{{ cake.id }}">
                    <i class="fas fa-edit me-1"></i>Edit
                  </button>
                  <form method="POST" action="{{ url_for('delete_cake', cake_id=cake.id) }}" onsubmit="return confirm('Are you sure you want to delete this cake?');" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger w-100">
                      <i class="fas fa-trash me-1"></i>Delete
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit Modal for each cake -->
          <div class="modal fade" id="editCakeModal{{ cake.id }}" tabindex="-1">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <form method="POST" action="{{ url_for('edit_cake', cake_id=cake.id) }}" enctype="multipart/form-data">
                  <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                      <i class="fas fa-edit me-2"></i>Edit Cake
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <label class="form-label">Current Image</label>
                      {% if cake.image %}
                        <div class="mb-2">
                          <img src="{{ url_for('static', filename='uploads/' + cake.image) }}" alt="{{ cake.name }}" style="max-width: 200px; height: auto; border-radius: 8px;">
                          <p class="text-muted small mt-1">Image cannot be changed after upload</p>
                        </div>
                      {% else %}
                        <p class="text-muted">No image uploaded</p>
                      {% endif %}
                    </div>

                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Cake Name *</label>
                        <input type="text" class="form-control" name="name" value="{{ cake.name }}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Category *</label>
                        <select class="form-select" name="category" required>
                          <option value="Birthday" {{ 'selected' if cake.category == 'Birthday' }}>Birthday</option>
                          <option value="Wedding" {{ 'selected' if cake.category == 'Wedding' }}>Wedding</option>
                          <option value="Anniversary" {{ 'selected' if cake.category == 'Anniversary' }}>Anniversary</option>
                          <option value="Custom" {{ 'selected' if cake.category == 'Custom' }}>Custom</option>
                        </select>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label">Description *</label>
                      <textarea class="form-control" name="description" rows="3" required>{{ cake.description }}</textarea>
                    </div>

                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Price (‚Ç±) *</label>
                        <input type="number" class="form-control" name="price" value="{{ cake.price }}" step="0.01" min="0" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Quantity (Max Orders) *</label>
                        <input type="number" class="form-control" name="quantity" value="{{ cake.quantity }}" min="0" required>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label class="form-label">Status</label>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="status" {{ 'checked' if cake.status }}>
                        <label class="form-check-label">
                          Available (Uncheck to mark as unavailable)
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                      <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-warning text-dark">
                      <i class="fas fa-save me-2"></i>Update Cake
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          {% else %}
          <!-- Empty state -->
          <div class="col-12 text-center py-5">
            <i class="fas fa-cake-candles fa-4x text-muted mb-3"></i>
            <h5 class="text-muted">No cakes added yet</h5>
            <p class="text-muted">Click "Add New Cake" to get started</p>
          </div>
          {% endfor %}
        </div>

        <!-- PAGINATION FOR CAKES -->
        <nav aria-label="Cakes pagination" class="mt-4">
          <ul class="pagination justify-content-end mb-0" id="cakesPagination">
            <!-- Pagination buttons generated by JavaScript -->
          </ul>
        </nav>
      </div>
    </div>
  </section>
  
</div>

<!-- CAKE MODAL FORM - ADD NEW CAKE -->
<div class="modal fade" id="cakeModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="POST" action="{{ url_for('add_cake') }}" enctype="multipart/form-data">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title">
            <i class="fas fa-cake-candles me-2"></i>Add Cake
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Cake Image</label>
            <input type="file" class="form-control" name="image" accept="image/*">
            <small class="text-muted">Upload an image of the cake (JPG, PNG, max 5MB)</small>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Cake Name *</label>
              <input type="text" class="form-control" name="name" required placeholder="e.g., Chocolate Dream">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Category *</label>
              <select class="form-select" name="category" required>
                <option value="">Select category</option>
                <option value="Birthday">Birthday</option>
                <option value="Wedding">Wedding</option>
                <option value="Anniversary">Anniversary</option>
                <option value="Custom">Custom</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description *</label>
            <textarea class="form-control" name="description" rows="3" required placeholder="Describe the cake (flavors, ingredients, size, etc.)"></textarea>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Price (‚Ç±) *</label>
              <input type="number" class="form-control" name="price" step="0.01" min="0" required placeholder="0.00">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Quantity (Max Orders) *</label>
              <input type="number" class="form-control" name="quantity" min="0" required placeholder="0">
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Status</label>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" name="status" checked>
              <label class="form-check-label">
                Available (Uncheck to mark as unavailable - won't display to customers)
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
          <button type="submit" class="btn btn-warning text-dark">
            <i class="fas fa-save me-2"></i>Save Cake
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- DETAILS MODALS -->
{% for o in orders %}
<div class="modal fade" id="details{{ o.id }}" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header {% if o.rush %}bg-danger text-white{% else %}bg-primary text-white{% endif %}">
        <h5 class="modal-title">
          <i class="fas fa-receipt me-2"></i>Order Details
          {% if o.rush %}
            <span class="badge bg-white text-danger ms-2">RUSH ORDER</span>
          {% endif %}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-muted mb-3">ORDER INFORMATION</h6>
            <p class="mb-2">
              <strong><i class="fas fa-cake-candles me-2 text-primary"></i>Order:</strong><br>
              <span class="ms-4">{{ o.item }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-calendar me-2 text-primary"></i>Delivery Date:</strong><br>
              <span class="ms-4">{{ o.delivery_date.strftime('%B %d, %Y - %I:%M %p') }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-info-circle me-2 text-primary"></i>Status:</strong><br>
              <span class="ms-4">
                <span class="badge
                  {% if o.status == 'New' %}bg-secondary
                  {% elif o.status == 'Accepted' %}bg-info
                  {% elif o.status == 'Pending' %}bg-warning text-dark
                  {% elif o.status == 'Ready' %}bg-primary
                  {% elif o.status == 'Out for Delivery' %}bg-dark
                  {% elif o.status == 'Completed' %}bg-success
                  {% elif o.status == 'Cancelled' %}bg-danger
                  {% endif %}">
                  {{ o.status }}
                </span>
              </span>
            </p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted mb-3">CUSTOMER INFORMATION</h6>
            <p class="mb-2">
              <strong><i class="fas fa-user me-2 text-success"></i>Name:</strong><br>
              <span class="ms-4">{{ o.customer.name }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-phone me-2 text-success"></i>Contact:</strong><br>
              <span class="ms-4">{{ o.customer.contact }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-location-dot me-2 text-success"></i>Address:</strong><br>
              <span class="ms-4">{{ o.customer.address }}</span>
            </p>
          </div>
        </div>
        
        <hr>
        
        <div class="row">
          <div class="col-md-6">
            <p class="mb-2">
              <strong><i class="fas fa-gift me-2 text-warning"></i>Occasion:</strong><br>
              <span class="ms-4">{{ o.customer.occasion }}</span>
            </p>
          </div>
          <div class="col-md-6">
            <p class="mb-2">
              <strong><i class="fas fa-user-circle me-2 text-warning"></i>Celebrant:</strong><br>
              <span class="ms-4">{{ o.customer.celebrant or 'N/A' }}</span>
            </p>
          </div>
          <div class="col-md-6">
            <p class="mb-2">
              <strong><i class="fas fa-cake-candles me-2 text-warning"></i>Age:</strong><br>
              <span class="ms-4">{{ o.customer.age or 'N/A' }}</span>
            </p>
          </div>
        </div>
        
        {% if o.notes %}
        <hr>
        <div class="alert alert-info mb-0">
          <h6 class="alert-heading">
            <i class="fas fa-sticky-note me-2"></i>Special Instructions
          </h6>
          <p class="mb-0">{{ o.notes }}</p>
        </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-2"></i>Close
        </button>
      </div>
    </div>
  </div>
</div>
</div>
{% endfor %}

<script src="https://cdn.jsdelivjs.com/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Confirmation dialog for status update
function confirmStatus(currentStatus) {
  return confirm(
    "Current status: " + currentStatus +
    "\n\nAre you sure you want to update this order?"
  );
}

// ============ ONE GENERIC FUNCTION: Search + Pagination (FOR ALL TABLES/SECTIONS) ============
function searchAndPagination(tableSelector, searchInputId, paginationId, itemsPerPage) {
  let currentPage = 1;
  const searchInput = document.getElementById(searchInputId);
  
  function updateDisplay() {
    const searchValue = searchInput.value.toLowerCase();
    const allItems = document.querySelectorAll(tableSelector);
    let visibleItems = [];
    
    // Filter by search only (filters already did their job, hidden items stay hidden)
    allItems.forEach(item => {
      if (item.style.display !== 'none') {  // Skip already-hidden items
        const text = item.textContent.toLowerCase();
        if (text.includes(searchValue)) {
          visibleItems.push(item);
        }
      }
    });
    
    // Calculate pagination
    const totalPages = Math.ceil(visibleItems.length / itemsPerPage);
    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    
    // Hide all, show only current page
    allItems.forEach(item => item.style.display = 'none');
    visibleItems.forEach((item, index) => {
      if (index >= start && index < end) {
        item.style.display = '';
      }
    });
    
    // Create pagination buttons
    updatePaginationButtons(paginationId, currentPage, totalPages, (page) => {
      currentPage = page;
      updateDisplay();
    });
  }
  
  // Listen for search
  searchInput.addEventListener('keyup', () => {
    currentPage = 1;
    updateDisplay();
  });
  
  updateDisplay();
}

// ============ FILTER FUNCTIONS (Just filter rows, don't touch pagination) ============

// FILTER 1: Order Filter (Sales) - gets value from id="orderFilterSales"
function orderFilter() {
  const filterValue = document.getElementById('orderFilterSales').value;
  const allRows = document.querySelectorAll('#salesTable tbody tr');
  
  allRows.forEach(row => {
    if (!filterValue || row.textContent.includes(filterValue)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
  
  // Trigger search to recalculate pagination
  document.getElementById('searchSales').dispatchEvent(new Event('keyup'));
}

// FILTER 2: Status Filter (Inventory) - gets value from id="statusFilterInventory"
function statusFilter() {
  const filterValue = document.getElementById('statusFilterInventory').value;
  const allRows = document.querySelectorAll('#inventoryTable tbody tr');
  
  allRows.forEach(row => {
    let matchStatus = true;
    
    if (filterValue === 'critical') {
      matchStatus = row.classList.contains('table-danger');
    } else if (filterValue === 'low') {
      matchStatus = row.classList.contains('table-warning');
    } else if (filterValue === 'good') {
      matchStatus = !row.classList.contains('table-danger') && !row.classList.contains('table-warning');
    }
    
    row.style.display = matchStatus ? '' : 'none';
  });
  
  // Trigger search to recalculate pagination
  document.getElementById('searchInventory').dispatchEvent(new Event('keyup'));
}

// FILTER 3: Orders Filters - gets values from id="statusFilter" and id="rushFilter"
function ordersFilters() {
  const statusValue = document.getElementById('statusFilter').value;
  const rushValue = document.getElementById('rushFilter').value;
  const allRows = document.querySelectorAll('#ordersTable tbody tr');
  
  allRows.forEach(row => {
    // Status match
    const statusBadge = row.querySelector('td:nth-child(5) .badge');
    const matchStatus = !statusValue || (statusBadge && statusBadge.textContent.trim() === statusValue);
    
    // Rush match
    const isRush = row.classList.contains('table-danger');
    const matchRush = !rushValue || (rushValue === 'yes' && isRush) || (rushValue === 'no' && !isRush);
    
    row.style.display = (matchStatus && matchRush) ? '' : 'none';
  });
  
  // Trigger search to recalculate pagination
  document.getElementById('searchOrders').dispatchEvent(new Event('keyup'));
}

// FILTER 4: Cakes Filters - gets values from id="categoryFilter" and id="cakeStatusFilter"
function cakesFilters() {
  const categoryValue = document.getElementById('categoryFilter').value;
  const statusValue = document.getElementById('cakeStatusFilter').value;
  const allItems = document.querySelectorAll('.cake-item');
  
  allItems.forEach(item => {
    const category = item.getAttribute('data-category');
    const status = item.getAttribute('data-status');
    
    const matchCategory = !categoryValue || category === categoryValue;
    const matchStatus = !statusValue || status === statusValue;
    
    item.style.display = (matchCategory && matchStatus) ? '' : 'none';
  });
  
  // Trigger search to recalculate pagination
  document.getElementById('searchCakes').dispatchEvent(new Event('keyup'));
}

// ============ Universal Pagination Button Generator ============
function updatePaginationButtons(containerId, currentPage, totalPages, onPageClick) {
  const container = document.getElementById(containerId);
  if (!container) return;
  
  let html = '';
  
  html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
    <a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>
  </li>`;
  
  for (let i = 1; i <= totalPages; i++) {
    if (totalPages <= 5 || i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
      html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
        <a class="page-link" href="#" data-page="${i}">${i}</a>
      </li>`;
    } else if (i === currentPage - 2 || i === currentPage + 2) {
      html += `<li class="page-item disabled"><a class="page-link" href="#">...</a></li>`;
    }
  }
  
  html += `<li class="page-item ${currentPage === totalPages || totalPages === 0 ? 'disabled' : ''}">
    <a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>
  </li>`;
  
  container.innerHTML = html;
  
  container.querySelectorAll('a.page-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const page = parseInt(link.getAttribute('data-page'));
      if (page && page !== currentPage && page >= 1 && page <= totalPages) {
        onPageClick(page);
      }
    });
  });
}

// ============ INITIALIZATION ============
window.addEventListener('load', function() {
  // 1. SET UP GENERIC SEARCH + PAGINATION FOR ALL TABLES
  searchAndPagination('#salesTable tbody tr', 'searchSales', 'salesPagination', 10);
  searchAndPagination('#expensesTable tbody tr', 'searchExpenses', 'expensesPagination', 10);
  searchAndPagination('#inventoryTable tbody tr', 'searchInventory', 'inventoryPagination', 10);
  searchAndPagination('#ordersTable tbody tr', 'searchOrders', 'ordersPagination', 6);
  searchAndPagination('.cake-item', 'searchCakes', 'cakesPagination', 8);
  
  // 2. SET UP FILTER EVENT LISTENERS (they trigger when user changes dropdown)
  document.getElementById('orderFilterSales').addEventListener('change', orderFilter);
  document.getElementById('statusFilterInventory').addEventListener('change', statusFilter);
  document.getElementById('statusFilter').addEventListener('change', ordersFilters);
  document.getElementById('rushFilter').addEventListener('change', ordersFilters);
  document.getElementById('categoryFilter').addEventListener('change', cakesFilters);
  document.getElementById('cakeStatusFilter').addEventListener('change', cakesFilters);
  
  // 3. RUN FILTERS ONCE on page load
  orderFilter();
  statusFilter();
  ordersFilters();
  cakesFilters();
});
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    const href = this.getAttribute('href');
    if (href !== '#') {
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    }
  });
});

setTimeout(function() {
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(function(alert) {
    const bsAlert = new bootstrap.Alert(alert);
    bsAlert.close();
  });
}, 5000);
</script>

</body>
</html>