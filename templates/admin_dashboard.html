<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin ‚Äì Ms. Brave Cake Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Google Charts -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load("current", {packages:["corechart"]});
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
      // Weekly Sales
      var salesData = google.visualization.arrayToDataTable([
        ['Day', 'Sales'],
        {% for day, val in weekly_sales.items() %}
        ['{{ day }}', {{ val|float }}],
        {% endfor %}
      ]);
      var salesChart = new google.visualization.PieChart(document.getElementById('weeklySalesChart'));
      salesChart.draw(salesData, {
        title: 'Weekly Sales',
        is3D: true,
        width: 250,
        height: 250
      });

      // Weekly Expenses
      var expensesData = google.visualization.arrayToDataTable([
        ['Day', 'Expenses'],
        {% for day, val in weekly_expenses.items() %}
        ['{{ day }}', {{ val|float }}],
        {% endfor %}
      ]);
      var expensesChart = new google.visualization.PieChart(document.getElementById('weeklyExpensesChart'));
      expensesChart.draw(expensesData, {
        title: 'Weekly Expenses',
        is3D: true,
        width: 250,
        height: 250
      });

      // Weekly Profit
      var profitData = google.visualization.arrayToDataTable([
        ['Day', 'Profit'],
        {% for day, val in weekly_profit.items() %}
        ['{{ day }}', {{ val|float }}],
        {% endfor %}
      ]);
      var profitChart = new google.visualization.ColumnChart(
        document.getElementById('weeklyProfitChart')
      );
      profitChart.draw(profitData, {
        title: 'Weekly Profit',
        width: 250,
        height: 250,
        legend: { position: 'none' },
        colors: ['#28a745']
      });
    }
  </script>

  <style>
    /* Custom Styles for Cake Availability Section */
    .cake-card {
      transition: all 0.3s ease;
      border: 1px solid #dee2e6;
    }
    .cake-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .cake-image-placeholder {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, #ffecd1 0%, #f5dac0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      border-radius: 8px 8px 0 0;
    }
    .cake-status-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1;
    }
  </style>

</head>
<body class="bg-light">

<!-- OFF CANVAS SIDEBAR MENU -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="adminMenu">
  <div class="offcanvas-header bg-dark text-white">
    <h5 class="offcanvas-title">
      <i class="fas fa-cake-candles me-2"></i>Ms. Brave Admin
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div class="list-group list-group-flush w-100">
      
      <!-- DASHBOARD -->
      <a href="#dashboard" class="list-group-item list-group-item-action active ps-4" onclick="closeOffcanvas()">
        <i class="fas fa-home me-3"></i><strong>Dashboard</strong>
      </a>
      
      <div class="dropdown-divider my-2"></div>
      
      
      <a href="#status-overview" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-tachometer-alt me-3 text-primary"></i>Status Overview
      </a>
      <a href="#analytics" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-chart-line me-3 text-success"></i>Analytics
      </a>
      <a href="#urgent-alerts" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-exclamation-triangle me-3 text-warning"></i>Urgent Alerts
      </a>
      <a href="#sales" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-money-bill-wave me-3 text-success"></i>Sales
      </a>
      <a href="#expenses" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-receipt me-3 text-danger"></i>Expenses
      </a>
      <a href="#inventory" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-boxes me-3 text-info"></i>Inventory
      </a>
      <a href="#orders" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-list-check me-3 text-primary"></i>Order List
      </a>
      <a href="#cake-availability" class="list-group-item list-group-item-action ps-4 py-2" onclick="closeOffcanvas()">
        <i class="fas fa-cake-candles me-3 text-warning"></i>Cake Availability
      </a>
      
      <div class="dropdown-divider my-3"></div>
      
      <!-- LOGOUT -->
      <a href="/logout" class="list-group-item list-group-item-action d-flex align-items-center py-3 text-danger">
        <i class="fas fa-sign-out-alt fs-5 me-3"></i>
        <strong>Logout</strong>
      </a>
    </div>
  </div>
</div>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
  <div class="container-fluid">
    <button class="btn btn-outline-light me-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#adminMenu">
      <i class="fas fa-bars"></i> Menu
    </button>
    <span class="navbar-brand mb-0 h1">
      <i class="fas fa-cake-candles me-2"></i>Ms. Brave Cake Shop - Admin Dashboard
    </span>
    <span class="navbar-text text-white ms-auto d-none d-md-block">
      <i class="far fa-clock me-2"></i>
      <span id="currentTime"></span>
    </span>
  </div>
</nav>

<div class="container-fluid my-4 px-4" id="dashboard">
  
  <!-- DASHBOARD HEADER -->
  <div class="section-header">
    <h1 class="mb-2">
      <i class="fas fa-chart-pie me-3"></i>Admin Dashboard
    </h1>
    <p class="mb-0 opacity-75">Complete overview of your cake shop business</p>
  </div>
  
  <!-- ============ 1. STATUS OVERVIEW (Stat Cards) ============ -->
  <section id="status-overview" class="mb-5">
    <h3 class="mb-3">
      <i class="fas fa-tachometer-alt me-2 text-primary"></i>Status Overview
    </h3>
    <div class="row g-3">
      <!-- NEW Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-secondary">
          <div class="fs-2 mb-2">üÜï</div>
          <h6 class="text-muted mb-1">NEW</h6>
          <h2 class="mb-0 fw-bold text-secondary">{{ total_new }}</h2>
        </div>
      </div>
      <!-- ACCEPTED Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-info">
          <div class="fs-2 mb-2">‚úÖ</div>
          <h6 class="text-muted mb-1">ACCEPTED</h6>
          <h2 class="mb-0 fw-bold text-info">{{ total_accepted }}</h2>
        </div>
      </div>
      <!-- PENDING Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-warning">
          <div class="fs-2 mb-2">‚è≥</div>
          <h6 class="text-muted mb-1">PENDING</h6>
          <h2 class="mb-0 fw-bold text-warning">{{ total_pending }}</h2>
        </div>
      </div>
      <!-- READY Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-primary">
          <div class="fs-2 mb-2">üéÇ</div>
          <h6 class="text-muted mb-1">READY</h6>
          <h2 class="mb-0 fw-bold text-primary">{{ total_ready }}</h2>
        </div>
      </div>
      <!-- OUT FOR DELIVERY Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-dark">
          <div class="fs-2 mb-2">üì¶</div>
          <h6 class="text-muted mb-1">OUT FOR DELIVERY</h6>
          <h2 class="mb-0 fw-bold">{{ total_out }}</h2>
        </div>
      </div>
      <!-- COMPLETED Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-success">
          <div class="fs-2 mb-2">üü¢</div>
          <h6 class="text-muted mb-1">COMPLETED</h6>
          <h2 class="mb-0 fw-bold text-success">{{ total_completed }}</h2>
        </div>
      </div>
      <!-- CANCELLED Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-danger">
          <div class="fs-2 mb-2">‚ùå</div>
          <h6 class="text-muted mb-1">CANCELLED</h6>
          <h2 class="mb-0 fw-bold text-danger">{{ total_cancelled }}</h2>
        </div>
      </div>
      <!-- RUSH Card -->
      <div class="col-6 col-lg-3">
        <div class="card stat-card text-center p-3 border-start border-5 border-danger">
          <div class="fs-2 mb-2">‚ö†Ô∏è</div>
          <h6 class="text-muted mb-1">RUSH ORDERS</h6>
          <h2 class="mb-0 fw-bold text-danger">{{ total_rush }}</h2>
        </div>
      </div>
    </div>
  </section>
  
  <!-- DIVIDER -->
  <div class="section-divider">
    <span class="section-divider-text">üìà BUSINESS ANALYTICS</span>
  </div>
  
  <!-- ============ 2. ANALYTICS (Charts) ============ -->
  <section id="analytics" class="mb-5">
    <h3 class="mb-3">
      <i class="fas fa-chart-line me-2 text-success"></i>Analytics Overview
    </h3>
    <div class="row">
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">üíµ Weekly Sales</h5>
            <div id="weeklySalesChart" style="width:100%; height:250px;"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">üí∞ Weekly Expenses</h5>
            <div id="weeklyExpensesChart" style="width:100%; height:250px;"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">üìä Weekly Profit</h5>
            <div id="weeklyProfitChart" style="width:100%; height:250px;"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- DIVIDER -->
  <div class="section-divider">
    <span class="section-divider-text">üö® URGENT ALERTS</span>
  </div>
  
  <!-- ============ 3. URGENT ALERTS (Low Stock + Today's Deliveries) ============ -->
  <section id="urgent-alerts" class="mb-5">
    <div class="row g-3">
      <!-- LOW STOCK ALERT -->
      <div class="col-lg-6">
        <div class="card urgent-alert-card shadow-sm h-100">
          <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">
              <i class="fas fa-exclamation-triangle me-2"></i>Low Stock Alert
            </h5>
          </div>
          <div class="card-body">
            {% if low_stock %}
              <div class="d-flex flex-wrap gap-2">
                {% for i in low_stock %}
                  <span class="badge {% if i.quantity < 5 %}bg-danger{% else %}bg-warning text-dark{% endif %} p-2 fs-6">
                    <i class="fas fa-box me-1"></i>{{ i.item }}: <strong>{{ i.quantity }} left</strong>
                  </span>
                {% endfor %}
              </div>
            {% else %}
              <div class="text-center py-4 text-muted">
                <i class="fas fa-check-circle fa-3x text-success mb-3 d-block"></i>
                <p class="mb-0">All items well stocked!</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- TODAY'S DELIVERIES -->
      <div class="col-lg-6">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">
              <i class="fas fa-truck me-2"></i>Today's Deliveries
            </h5>
          </div>
          <div class="card-body p-2" style="max-height: 350px; overflow-y: auto;">
            {% if today_deliveries %}
              {% for delivery in today_deliveries %}
              <div class="d-flex justify-content-between align-items-center border-bottom py-2 px-2">
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center mb-1">
                    <span class="badge bg-light text-dark me-2">
                      <i class="far fa-clock"></i> {{ delivery.time }}
                    </span>
                    {% if delivery.rush %}
                      <span class="badge bg-danger">RUSH</span>
                    {% endif %}
                  </div>
                  <strong class="d-block">{{ delivery.customer }}</strong>
                  <small class="text-muted">{{ delivery.cake[:35] }}{% if delivery.cake|length > 35 %}...{% endif %}</small>
                </div>
                <span class="badge ms-2
                  {% if delivery.status == 'New' %}bg-secondary
                  {% elif delivery.status == 'Accepted' %}bg-info
                  {% elif delivery.status == 'Pending' %}bg-warning text-dark
                  {% elif delivery.status == 'Ready' %}bg-primary
                  {% elif delivery.status == 'Out for Delivery' %}bg-dark
                  {% endif %}">
                  {{ delivery.status }}
                </span>
              </div>
              {% endfor %}
            {% else %}
              <div class="text-center py-5 text-muted">
                <i class="fas fa-calendar-check fa-3x mb-3 d-block"></i>
                <p class="mb-0">No deliveries scheduled for today</p>
              </div>
            {% endif %}
          </div>
          <div class="card-footer bg-white text-end">
            <small class="text-muted">
              <i class="fas fa-list-ol me-1"></i>Total: <strong>{{ today_count }}</strong> deliveries today
            </small>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- DIVIDER -->
  <div class="section-divider">
    <span class="section-divider-text">üìã DETAILED RECORDS</span>
  </div>
  
  <!-- ============ 4. SALES TABLE ============ -->
  <section id="sales" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-money-bill-wave me-2"></i>Sales Records
        </h4>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Order</th>
                <th>Amount (‚Ç±)</th>
              </tr>
            </thead>
            <tbody>
              {% for s in sales %}
              <tr>
                <td>{{ s.created_at.strftime('%b %d, %Y - %I:%M %p') }}</td>
                <td>{{ s.item }}</td>
                <td class="fw-bold text-success">‚Ç±{{ "%.2f"|format(s.amount) }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">
                  <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                  No sales yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
  
  <!-- ============ 5. EXPENSES TABLE ============ -->
  <section id="expenses" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-receipt me-2"></i>Expenses
        </h4>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Cost (‚Ç±)</th>
              </tr>
            </thead>
            <tbody>
              {% for e in expenses %}
              <tr>
                <td>{{ e.date.strftime("%b %d, %Y - %I:%M %p") }}</td>
                <td>{{ e.description }}</td>
                <td class="fw-bold text-danger">‚Ç±{{ "%.2f"|format(e.cost) }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">
                  <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                  No expenses yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
  
  <!-- ============ 6. INVENTORY TABLE ============ -->
  <section id="inventory" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-boxes me-2"></i>Inventory Management
        </h4>
      </div>
      <div class="card-body">
        <form method="POST" action="/inventory/add" class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label">Item Name</label>
            <input name="item" class="form-control" placeholder="e.g., Flour, Sugar" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Quantity</label>
            <input name="quantity" type="number" class="form-control" placeholder="0" min="1" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Cost (‚Ç±)</label>
            <input name="cost" type="number" class="form-control" placeholder="0.00" step="0.01" min="0" required>
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">
              <i class="fas fa-plus me-2"></i>Add Item
            </button>
          </div>
        </form>
        
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-dark">
              <tr>
                <th>Item</th>
                <th>Quantity</th>
                <th>Cost (‚Ç±)</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for i in inventory %}
              <tr class="{% if i.quantity < 5 %}table-danger{% elif i.quantity < 10 %}table-warning{% endif %}">
                <td>{{ i.item }}</td>
                <td>
                  <span class="badge 
                    {% if i.quantity < 5 %}bg-danger
                    {% elif i.quantity < 10 %}bg-warning text-dark
                    {% else %}bg-success
                    {% endif %}">
                    {{ i.quantity }}
                  </span>
                </td>
                <td>‚Ç±{{ i.cost }}</td>
                <td>
                  {% if i.quantity < 5 %}
                    <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i> Critical</span>
                  {% elif i.quantity < 10 %}
                    <span class="badge bg-warning text-dark"><i class="fas fa-exclamation"></i> Low Stock</span>
                  {% else %}
                    <span class="badge bg-success"><i class="fas fa-check"></i> Good</span>
                  {% endif %}
                </td>
                <td>
                  <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal{{ i.id }}">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                </td>
              </tr>
              
              <!-- Edit Modal -->
              <div class="modal fade" id="editModal{{ i.id }}" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <form method="POST" action="/inventory/edit/{{ i.id }}">
                      <div class="modal-header">
                        <h5 class="modal-title">
                          <i class="fas fa-edit me-2"></i>Edit Inventory Item
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                      </div>
                      <div class="modal-body">
                        <div class="mb-3">
                          <label class="form-label">Item Name</label>
                          <input name="item" value="{{ i.item }}" class="form-control" required>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Quantity</label>
                          <input name="quantity" type="number" value="{{ i.quantity }}" class="form-control" min="1" required>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Cost (‚Ç±)</label>
                          <input name="cost" type="number" value="{{ i.cost }}" class="form-control" step="0.01" min="0" required>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">
                          <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              {% else %}
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                  No inventory items yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
  
  <!-- ============ 7. ORDER LIST ============ -->
  <section id="orders" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header card-header-custom">
        <h4 class="mb-0">
          <i class="fas fa-list-check me-2"></i>Order Management
        </h4>
      </div>
      <div class="card-body">
        <!-- SEARCH & FILTERS -->
        <div class="row mb-3">
          <div class="col-md-6 mb-2">
            <div class="input-group">
              <span class="input-group-text bg-white">
                <i class="fas fa-search"></i>
              </span>
              <input type="text" class="form-control" placeholder="Search orders, customers, contact..." id="searchOrders">
            </div>
          </div>
          <div class="col-md-6">
            <div class="row g-2">
              <div class="col-md-4">
                <select class="form-select" id="statusFilter">
                  <option value="">All Status</option>
                  <option value="New">üÜï New</option>
                  <option value="Accepted">‚úÖ Accepted</option>
                  <option value="Pending">‚è≥ Pending</option>
                  <option value="Ready">üéÇ Ready</option>
                  <option value="Out for Delivery">üì¶ Out for Delivery</option>
                  <option value="Completed">üü¢ Completed</option>
                  <option value="Cancelled">‚ùå Cancelled</option>
                </select>
              </div>
              <div class="col-md-4">
                <select class="form-select" id="dateFilter">
                  <option value="">All Dates</option>
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
              </div>
              <div class="col-md-4">
                <select class="form-select" id="rushFilter">
                  <option value="">All Orders</option>
                  <option value="yes">‚ö†Ô∏è Rush Only</option>
                  <option value="no">Non-Rush</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ORDERS TABLE -->
        <div class="table-responsive">
          <table class="table table-hover align-middle" id="ordersTable">
            <thead class="table-dark">
              <tr>
                <th>Date Ordered</th>
                <th>Customer</th>
                <th>Order Details</th>
                <th>Delivery Date</th>
                <th>Status</th>
                <th>Details</th>
                <th>Update Status</th>
              </tr>
            </thead>
            <tbody>
              {% for o in orders %}
              <tr class="{% if o.rush %}table-danger{% endif %}">
                <td>
                  <small>{{ o.created_at.strftime('%b %d, %Y') }}</small><br>
                  <small class="text-muted">{{ o.created_at.strftime('%I:%M %p') }}</small>
                </td>
                <td>
                  <strong>{{ o.customer.name }}</strong>
                  {% if o.rush %}
                    <span class="badge bg-danger ms-1">RUSH</span>
                  {% endif %}
                  <br>
                  <small class="text-muted">
                    <i class="fas fa-phone me-1"></i>{{ o.customer.contact }}
                  </small>
                </td>
                <td>
                  <span class="text-truncate d-inline-block" style="max-width: 200px;" title="{{ o.item }}">
                    {{ o.item }}
                  </span>
                </td>
                <td>
                  <small>{{ o.delivery_date.strftime('%b %d, %Y') }}</small><br>
                  <small class="text-muted">{{ o.delivery_date.strftime('%I:%M %p') }}</small>
                </td>
                <td>
                  <span class="badge
                    {% if o.status == 'New' %}bg-secondary
                    {% elif o.status == 'Accepted' %}bg-info
                    {% elif o.status == 'Pending' %}bg-warning text-dark
                    {% elif o.status == 'Ready' %}bg-primary
                    {% elif o.status == 'Out for Delivery' %}bg-dark
                    {% elif o.status == 'Completed' %}bg-success
                    {% elif o.status == 'Cancelled' %}bg-danger
                    {% endif %}">
                    {{ o.status }}
                  </span>
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#details{{ o.id }}">
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
                <td>
                  <form method="POST" action="/order/status/{{ o.user_id }}/{{ o.id }}" onsubmit="return confirmStatus('{{ o.status }}')">
                    <select name="status" class="form-select form-select-sm mb-1">
                      <option value="New" {{ 'selected' if o.status=='New' }}>üÜï New</option>
                      <option value="Accepted" {{ 'selected' if o.status=='Accepted' }}>‚úÖ Accepted</option>
                      <option value="Pending" {{ 'selected' if o.status=='Pending' }}>‚è≥ Pending</option>
                      <option value="Ready" {{ 'selected' if o.status=='Ready' }}>üéÇ Ready</option>
                      <option value="Out for Delivery" {{ 'selected' if o.status=='Out for Delivery' }}>üì¶ Out for Delivery</option>
                      <option value="Completed" {{ 'selected' if o.status=='Completed' }}>üü¢ Completed</option>
                      <option value="Cancelled" {{ 'selected' if o.status=='Cancelled' }}>‚ùå Cancelled</option>
                    </select>
                    <button class="btn btn-primary btn-sm w-100">
                      <i class="fas fa-sync-alt"></i> Update
                    </button>
                  </form>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="7" class="text-center text-muted py-5">
                  <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                  No orders yet
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- ============ 8. CAKE AVAILABILITY SECTION ============ -->
  <section id="cake-availability" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
        <h4 class="mb-0">
          <i class="fas fa-cake-candles me-2"></i>Cake Availability
        </h4>
        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#cakeModal" onclick="resetCakeForm()">
          <i class="fas fa-plus me-2"></i>Add New Cake
        </button>
      </div>
      <div class="card-body">
        <!-- SEARCH & FILTERS -->
        <div class="row mb-4">
          <div class="col-md-6 mb-2">
            <div class="input-group">
              <span class="input-group-text bg-white">
                <i class="fas fa-search"></i>
              </span>
              <input type="text" class="form-control" placeholder="Search cakes by name..." id="searchCakes">
            </div>
          </div>
          <div class="col-md-3 mb-2">
            <select class="form-select" id="categoryFilter">
              <option value="">All Categories</option>
              <option value="Birthday">Birthday</option>
              <option value="Wedding">Wedding</option>
              <option value="Anniversary">Anniversary</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          <div class="col-md-3 mb-2">
            <select class="form-select" id="cakeStatusFilter">
              <option value="">All Status</option>
              <option value="available">Available</option>
              <option value="unavailable">Unavailable</option>
            </select>
          </div>
        </div>

        <!-- CAKE CARDS GRID -->
        <div class="row g-3" id="cakeGrid">
          <!-- Sample Cake Cards - Replace with backend data -->
          {% for cake in cakes %}
          <div class="col-lg-3 col-md-4 col-sm-6 cake-item" 
               data-name="{{ cake.name|lower }}" 
               data-category="{{ cake.category }}" 
               data-status="{{ 'available' if cake.status else 'unavailable' }}">
            <div class="card cake-card h-100">
              <div class="position-relative">
                <div class="cake-image-placeholder">
                  {% if cake.image %}
                    <img src="{{ cake.image }}" alt="{{ cake.name }}" style="width:100%; height:200px; object-fit:cover;">
                  {% else %}
                    üéÇ
                  {% endif %}
                </div>
                <span class="badge cake-status-badge {{ 'bg-success' if cake.status else 'bg-danger' }}">
                  {{ 'Available' if cake.status else 'Unavailable' }}
                </span>
              </div>
              <div class="card-body">
                <h5 class="card-title mb-2">{{ cake.name }}</h5>
                <span class="badge bg-warning text-dark mb-2">{{ cake.category }}</span>
                <p class="card-text small text-muted mb-2">{{ cake.description[:60] }}...</p>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <span class="fw-bold text-success fs-5">‚Ç±{{ "%.2f"|format(cake.price) }}</span>
                  <span class="badge bg-secondary">{{ cake.quantity }} left</span>
                </div>
                <div class="d-grid gap-2">
                  <button class="btn btn-sm btn-primary" onclick="editCake({{ cake.id }})">
                    <i class="fas fa-edit me-1"></i>Edit
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="deleteCake({{ cake.id }})">
                    <i class="fas fa-trash me-1"></i>Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% else %}
          <!-- Empty state -->
          <div class="col-12 text-center py-5">
            <i class="fas fa-cake-candles fa-4x text-muted mb-3"></i>
            <h5 class="text-muted">No cakes added yet</h5>
            <p class="text-muted">Click "Add New Cake" to get started</p>
          </div>
          {% endfor %}
        </div>

        <!-- PAGINATION -->
        <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
          <div class="text-muted" id="cakeCount">
            Showing 1-8 of {{ cakes|length }} cakes
          </div>
          <nav>
            <ul class="pagination mb-0" id="cakePagination">
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Previous</a>
              </li>
              <li class="page-item active"><a class="page-link" href="#">1</a></li>
              <li class="page-item"><a class="page-link" href="#">2</a></li>
              <li class="page-item"><a class="page-link" href="#">3</a></li>
              <li class="page-item">
                <a class="page-link" href="#">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </section>
  
</div>

<!-- CAKE MODAL FORM -->
<div class="modal fade" id="cakeModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="POST" action="/cake/add" enctype="multipart/form-data" id="cakeForm">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title" id="cakeModalTitle">
            <i class="fas fa-cake-candles me-2"></i>Add Cake
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="cake_id" id="cakeId">
          
          <div class="mb-3">
            <label class="form-label">Cake Image</label>
            <input type="file" class="form-control" name="image" accept="image/*">
            <small class="text-muted">Upload an image of the cake (JPG, PNG)</small>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Cake Name *</label>
              <input type="text" class="form-control" name="name" id="cakeName" required placeholder="e.g., Chocolate Dream">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Category *</label>
              <select class="form-select" name="category" id="cakeCategory" required>
                <option value="">Select category</option>
                <option value="Birthday">Birthday</option>
                <option value="Wedding">Wedding</option>
                <option value="Anniversary">Anniversary</option>
                <option value="Custom">Custom</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description *</label>
            <textarea class="form-control" name="description" id="cakeDescription" rows="3" required placeholder="Describe the cake (flavors, ingredients, size, etc.)"></textarea>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Price (‚Ç±) *</label>
              <input type="number" class="form-control" name="price" id="cakePrice" step="0.01" min="0" required placeholder="0.00">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Quantity (Max Orders) *</label>
              <input type="number" class="form-control" name="quantity" id="cakeQuantity" min="0" required placeholder="0">
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Status</label>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" name="status" id="cakeStatus" checked>
              <label class="form-check-label" for="cakeStatus">
                Available (Uncheck to mark as unavailable - won't display to customers)
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
          <button type="submit" class="btn btn-warning text-dark">
            <i class="fas fa-save me-2"></i>Save Cake
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- DETAILS MODALS -->
{% for o in orders %}
<div class="modal fade" id="details{{ o.id }}" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header {% if o.rush %}bg-danger text-white{% else %}bg-primary text-white{% endif %}">
        <h5 class="modal-title">
          <i class="fas fa-receipt me-2"></i>Order Details
          {% if o.rush %}
            <span class="badge bg-white text-danger ms-2">RUSH ORDER</span>
          {% endif %}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-muted mb-3">ORDER INFORMATION</h6>
            <p class="mb-2">
              <strong><i class="fas fa-cake-candles me-2 text-primary"></i>Order:</strong><br>
              <span class="ms-4">{{ o.item }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-calendar me-2 text-primary"></i>Delivery Date:</strong><br>
              <span class="ms-4">{{ o.delivery_date.strftime('%B %d, %Y - %I:%M %p') }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-info-circle me-2 text-primary"></i>Status:</strong><br>
              <span class="ms-4">
                <span class="badge
                  {% if o.status == 'New' %}bg-secondary
                  {% elif o.status == 'Accepted' %}bg-info
                  {% elif o.status == 'Pending' %}bg-warning text-dark
                  {% elif o.status == 'Ready' %}bg-primary
                  {% elif o.status == 'Out for Delivery' %}bg-dark
                  {% elif o.status == 'Completed' %}bg-success
                  {% elif o.status == 'Cancelled' %}bg-danger
                  {% endif %}">
                  {{ o.status }}
                </span>
              </span>
            </p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted mb-3">CUSTOMER INFORMATION</h6>
            <p class="mb-2">
              <strong><i class="fas fa-user me-2 text-success"></i>Name:</strong><br>
              <span class="ms-4">{{ o.customer.name }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-phone me-2 text-success"></i>Contact:</strong><br>
              <span class="ms-4">{{ o.customer.contact }}</span>
            </p>
            <p class="mb-2">
              <strong><i class="fas fa-location-dot me-2 text-success"></i>Address:</strong><br>
              <span class="ms-4">{{ o.customer.address }}</span>
            </p>
          </div>
        </div>
        
        <hr>
        
        <div class="row">
          <div class="col-md-6">
            <p class="mb-2">
              <strong><i class="fas fa-gift me-2 text-warning"></i>Occasion:</strong><br>
              <span class="ms-4">{{ o.customer.occasion }}</span>
            </p>
          </div>
          <div class="col-md-6">
            <p class="mb-2">
              <strong><i class="fas fa-user-circle me-2 text-warning"></i>Celebrant:</strong><br>
              <span class="ms-4">{{ o.customer.celebrant or 'N/A' }}</span>
            </p>
          </div>
          <div class="col-md-6">
            <p class="mb-2">
              <strong><i class="fas fa-cake-candles me-2 text-warning"></i>Age:</strong><br>
              <span class="ms-4">{{ o.customer.age or 'N/A' }}</span>
            </p>
          </div>
        </div>
        
        {% if o.notes %}
        <hr>
        <div class="alert alert-info mb-0">
          <h6 class="alert-heading">
            <i class="fas fa-sticky-note me-2"></i>Special Instructions
          </h6>
          <p class="mb-0">{{ o.notes }}</p>
        </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-2"></i>Close
        </button>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Close offcanvas when clicking a link
function closeOffcanvas() {
  const offcanvasElement = document.getElementById('adminMenu');
  const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasElement);
  if (offcanvas) {
    offcanvas.hide();
  }
}

// Confirmation dialog for status update
function confirmStatus(currentStatus) {
  return confirm(
    "Current status: " + currentStatus +
    "\n\nAre you sure you want to update this order?"
  );
}

// Live Search Function for Orders
document.getElementById('searchOrders').addEventListener('keyup', function() {
  let searchValue = this.value.toLowerCase();
  let tableRows = document.querySelectorAll('#ordersTable tbody tr');
  
  tableRows.forEach(row => {
    let text = row.textContent.toLowerCase();
    row.style.display = text.includes(searchValue) ? '' : 'none';
  });
});

// Status Filter
document.getElementById('statusFilter').addEventListener('change', function() {
  let status = this.value;
  let tableRows = document.querySelectorAll('#ordersTable tbody tr');
  
  tableRows.forEach(row => {
    if (!status) {
      row.style.display = '';
      return;
    }
    let statusBadge = row.querySelector('.badge');
    row.style.display = statusBadge && statusBadge.textContent.trim() === status ? '' : 'none';
  });
});

// Rush Filter
document.getElementById('rushFilter').addEventListener('change', function() {
  let rush = this.value;
  let tableRows = document.querySelectorAll('#ordersTable tbody tr');
  
  tableRows.forEach(row => {
    if (!rush) {
      row.style.display = '';
      return;
    }
    let isRush = row.classList.contains('table-danger');
    if (rush === 'yes') {
      row.style.display = isRush ? '' : 'none';
    } else {
      row.style.display = !isRush ? '' : 'none';
    }
  });
});

// Date Filter (placeholder)
document.getElementById('dateFilter').addEventListener('change', function() {
  console.log('Date filter:', this.value);
});

// ============ CAKE AVAILABILITY FUNCTIONS ============

// Search Cakes
document.getElementById('searchCakes').addEventListener('keyup', function() {
  filterCakes();
});

// Category Filter
document.getElementById('categoryFilter').addEventListener('change', function() {
  filterCakes();
});

// Status Filter
document.getElementById('cakeStatusFilter').addEventListener('change', function() {
  filterCakes();
});

function filterCakes() {
  let searchValue = document.getElementById('searchCakes').value.toLowerCase();
  let categoryValue = document.getElementById('categoryFilter').value;
  let statusValue = document.getElementById('cakeStatusFilter').value;
  
  let cakeItems = document.querySelectorAll('.cake-item');
  
  cakeItems.forEach(item => {
    let name = item.getAttribute('data-name');
    let category = item.getAttribute('data-category');
    let status = item.getAttribute('data-status');
    
    let matchSearch = name.includes(searchValue);
    let matchCategory = !categoryValue || category === categoryValue;
    let matchStatus = !statusValue || status === statusValue;
    
    if (matchSearch && matchCategory && matchStatus) {
      item.style.display = '';
    } else {
      item.style.display = 'none';
    }
  });
}

// Reset Cake Form
function resetCakeForm() {
  document.getElementById('cakeForm').reset();
  document.getElementById('cakeId').value = '';
  document.getElementById('cakeModalTitle').innerHTML = '<i class="fas fa-cake-candles me-2"></i>Add Cake';
  document.getElementById('cakeForm').action = '/cake/add';
}

// Edit Cake
function editCake(id) {
  // This would fetch cake data from backend
  // For now, just change modal title
  document.getElementById('cakeModalTitle').innerHTML = '<i class="fas fa-edit me-2"></i>Edit Cake';
  document.getElementById('cakeForm').action = '/cake/edit/' + id;
  document.getElementById('cakeId').value = id;
  
  // Show modal
  var cakeModal = new bootstrap.Modal(document.getElementById('cakeModal'));
  cakeModal.show();
  
  // You would fetch and populate form data here via AJAX
  // Example:
  // fetch('/cake/get/' + id)
  //   .then(response => response.json())
  //   .then(data => {
  //     document.getElementById('cakeName').value = data.name;
  //     document.getElementById('cakeCategory').value = data.category;
  //     // ... etc
  //   });
}

// Delete Cake
function deleteCake(id) {
  if (confirm('Are you sure you want to delete this cake?')) {
    // Send delete request to backend
    fetch('/cake/delete/' + id, {
      method: 'POST'
    })
    .then(response => {
      if (response.ok) {
        location.reload();
      }
    });
  }
}

// Current Time Display
function updateTime() {
  const now = new Date();
  const options = { 
    weekday: 'short', 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  };
  const timeElement = document.getElementById('currentTime');
  if (timeElement) {
    timeElement.textContent = now.toLocaleDateString('en-US', options);
  }
}

// Update time every minute
setInterval(updateTime, 60000);
updateTime(); // Initial call

// Smooth scroll to section when clicking menu links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    const href = this.getAttribute('href');
    if (href !== '#') {
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    }
  });
});
</script>

</body>
</html>