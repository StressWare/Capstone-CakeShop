<!-- customer_dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Dashboard - Ms. Brave Cake Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='customer_dashboard.css') }}">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-light bg-light fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/">üéÇ Ms. Brave Cake Shop</a>
    <button class="btn btn-outline-dark" data-bs-toggle="offcanvas" data-bs-target="#menu">
      ‚ò∞ Menu
    </button>
  </div>
</nav>

<!-- OFFCANVAS MENU -->
<div class="offcanvas offcanvas-end" id="menu">
  <div class="offcanvas-header">
    <h5>Navigate</h5>
    <button class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <a class="d-block mb-2" href="#profile">Profile</a>
    <a class="d-block mb-2" href="#orders">Order History</a>
  </div>
</div>

<div class="container mt-5 pt-5">
  <!-- PROFILE SECTION -->
  <section id="profile" class="mb-5">
    <h2 class="mb-3">My Profile</h2>
    <div class="card p-3">
      <p><strong>Full Name:</strong> {{ customer.fname }}</p>
      <p><strong>Username:</strong> {{ customer.username }}</p>
      <p><strong>Contact:</strong> {{ customer.number }}</p>
      <p><strong>Address:</strong> {{ customer.address }}</p>
      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editProfileModal">
        Edit Profile
      </button>
    </div>
  </section>

  <!-- ORDER HISTORY SECTION -->
  <section id="orders">
    <h2 class="mb-3">Order History</h2>
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>Items</th>
          <th>Total (‚Ç±)</th>
          <th>Delivery Date</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.id }}</td>
          <td>{{ order.item }}</td>
          <td>{{ "%.2f"|format(order.amount) }}</td>
          <td>{{ order.delivery_date.strftime('%b %d, %Y - %I:%M %p') }}</td>
          <td>{{ order.status }}</td>
          <td>
            <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#orderDetailsModal{{ order.id }}">
              View
            </button>
          </td>
        </tr>

        <!-- Order Details Modal -->
        <div class="modal fade" id="orderDetailsModal{{ order.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Order Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p><strong>Items:</strong> {{ order.item }}</p>
                <p><strong>Amount:</strong> ‚Ç±{{ "%.2f"|format(order.amount) }}</p>
                <p><strong>Delivery Date:</strong> {{ order.delivery_date.strftime('%b %d, %Y - %I:%M %p') }}</p>
                <p><strong>Status:</strong> {{ order.status }}</p>
                <p><strong>Occasion:</strong> {{ order.customer.occasion }}</p>
                <p><strong>Celebrant:</strong> {{ order.customer.celebrant or 'N/A' }}</p>
                <p><strong>Age:</strong> {{ order.customer.age or 'N/A' }}</p>
                <p><strong>Address:</strong> {{ order.customer.address }}</p>
                {% if order.notes %}
                <div class="alert alert-info mt-3">
                  <strong>üìù Special Instructions:</strong>
                  <p class="mb-0">{{ order.notes }}</p>
                </div>
                {% endif %}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted">No orders found</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- EDIT PROFILE MODAL -->
  <div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="POST" action="{{ url_for('edit_customer_profile') }}">
          <div class="modal-header">
            <h5 class="modal-title">Edit Profile</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label>Full Name</label>
              <input type="text" name="full_name" class="form-control" value="{{ customer.fname }}" required>
            </div>
            <div class="mb-3">
              <label>Username</label>
              <input type="text" name="username" class="form-control" value="{{ customer.username }}" required>
            </div>
            <div class="mb-3">
              <label>Contact</label>
              <input type="text" name="contact" class="form-control" value="{{ customer.number }}" required>
            </div>
            <div class="mb-3">
              <label>Address</label>
              <input type="text" name="address" class="form-control" value="{{ customer.address }}" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-success">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
