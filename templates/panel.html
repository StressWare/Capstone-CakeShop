<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel ‚Äì Ms. Brave Cake Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <span class="navbar-brand">üßÅ Ms. Brave Cake Shop</span>
    <div class="ms-auto">
      <a href="/admin_dashboard" class="btn btn-outline-light btn-sm me-2">Admin Dashboard</a>
      <a href="/admin_panel" class="btn btn-warning btn-sm">Admin Panel</a>
    </div>
  </div>
</nav>

<div class="container my-5">

  <!-- ================= ORDERS SECTION ================= -->
  <h2 class="mb-3">üßæ Orders Management</h2>

  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Date Ordered</th>
          <th>Customer</th>
          <th>Order Details</th>
          <th>Delivery Date</th>
          <th>Status</th>
          <th>Details</th>
          <th>Update Status</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr class="
          {% if o.rush %}table-danger{% endif %}
          {% if o.delivery_date == today %}table-warning{% endif %}
        ">
          <td>{{ o.date }}</td>
          <td>
            <strong>{{ o.customer.name }}</strong><br>
            <small class="text-muted">{{ o.customer.contact }}</small>
          </td>
          <td>
            {{ o.item }}<br>
            <small class="text-muted">{{ o.customer.occasion }}</small>
          </td>
          <td>{{ o.delivery_date }}</td>
          <td>
            <span class="badge
              {% if o.status == 'New' %}bg-secondary
              {% elif o.status == 'Accepted' %}bg-info
              {% elif o.status == 'Pending' %}bg-warning text-dark
              {% elif o.status == 'Completed' %}bg-success
              {% elif o.status == 'Cancelled' %}bg-danger
              {% endif %}">
              {{ o.status }}
            </span>
          </td>
          <!-- VIEW DETAILS BUTTON -->
          <td>
            <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#details{{ o._id }}">View</button>
          </td>
          <!-- UPDATE STATUS -->
          <td>
            <form method="POST" action="/order/status/{{ o._id }}" onsubmit="return confirmStatus('{{ o.status }}')">
              <select name="status" class="form-select form-select-sm mb-1">
                <option {{ 'selected' if o.status=='New' }}>New</option>
                <option {{ 'selected' if o.status=='Accepted' }}>Accepted</option>
                <option {{ 'selected' if o.status=='Pending' }}>Pending</option>
                <option {{ 'selected' if o.status=='Completed' }}>Completed</option>
                <option {{ 'selected' if o.status=='Cancelled' }}>Cancelled</option>
              </select>
              <button class="btn btn-primary btn-sm w-100">Update</button>
            </form>
          </td>
        </tr>

        <!-- DETAILS MODAL -->
        <div class="modal fade" id="details{{ o._id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Order Details</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p><strong>Name:</strong> {{ o.customer.name }}</p>
                <p><strong>Contact:</strong> {{ o.customer.contact }}</p>
                <p><strong>Address:</strong> {{ o.customer.address }}</p>
                <p><strong>Occasion:</strong> {{ o.customer.occasion }}</p>
                <p><strong>Celebrant:</strong> {{ o.customer.celebrant or 'N/A' }}</p>
                <p><strong>Age:</strong> {{ o.customer.age or 'N/A' }}</p>
                <p><strong>Rush:</strong>
                  {% if o.rush %}
                    <span class="badge bg-danger">YES</span>
                  {% else %}
                    No
                  {% endif %}
                </p>
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <tr>
          <td colspan="7" class="text-center text-muted">No orders yet</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ================= LOW STOCK ALERTS ================= -->
{% if low_stock %}
<h2 class="mt-5 mb-3">‚ö†Ô∏è Low Stock Alerts</h2>

<div class="table-responsive">
  <table class="table table-striped">
    <thead class="table-light">
      <tr>
        <th>Item</th>
        <th>Quantity</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for i in low_stock %}
      <tr class="{% if i.quantity < 5 %}table-danger{% else %}table-warning{% endif %}">
        <td>{{ i.item }}</td>
        <td>{{ i.quantity }}</td>
        <td>
          {% if i.quantity < 5 %}
          <span class="badge bg-danger">Critical</span>
          {% else %}
          <span class="badge bg-warning text-dark">Low</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function confirmStatus(currentStatus) {
  return confirm(
    "Current status: " + currentStatus +
    "\nAre you sure you want to update this order?"
  );
}
</script>

</body>
</html>
